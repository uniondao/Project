<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<!-- <meta name="viewport"  content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"> -->
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>UnionDao</title>
	<link rel="stylesheet" href="./css/reset.css">
	<link rel="stylesheet" href="./css/presale.css">
	<link rel="stylesheet" href="./js/need/layer.css">
	<script src="./js/jquery-3.4.0.min.js"></script>
	<script>
		$(document).ready(function () {
			$("header").load("./header.html");
			$("#footCont").load("./footer.html");
		});
	</script>
	<style>
		.layui-m-layer1 .layui-m-layerchild {
			border-radius: 12px !important;
		}
		.layui-m-layermain {
            display: flex!important;
            justify-content: center!important;
            align-items: center!important;
        }
	</style>
	<!-- 合约 -->
	<script type="text/javascript" src="./js/config/coinList.js"></script>
	<script type="text/javascript" src="./js/tools_func.js"></script>
	<script type="text/javascript" src="./js/config2.js"></script>
	<script type="text/javascript" src="./js/token/web3.min.js"></script>
    <script type="text/javascript" src="./js/token/abi/abi_und.js"></script>
    <script type="text/javascript" src="./js/token/abi/abi_udao.js"></script>
    <script type="text/javascript" src="./js/token/abi/abi_udao_issue.js"></script>
    <script type="text/javascript" src="./js/token/abi/abi_und_issue.js"></script>
    <script type="text/javascript" src="./js/token/abi/abi_usdt.js"></script>
    <script type="text/javascript" src="./js/token/abi/abi_candy.js"></script>
    <script type="text/javascript" src="./js/token/abi/abi_factory.js"></script>
    <script type="text/javascript" src="./js/token/abi/abi_exchange.js"></script>
	<script type="text/javascript" src="./js/token/web3_init.js"></script>

    <script type="text/javascript" src="./js/token/coin/eth2.js"></script>
    <script type="text/javascript" src="./js/token/coin/und2.js"></script>
    <script type="text/javascript" src="./js/token/coin/udao2.js"></script>
	<script type="text/javascript" src="./js/token/coin/exchange2.js"></script>
	<!-- 合约 -->
</head>

<body>
	<div class="wrapper">
		<div class="main">
			<header></header>
			<div id="exchangeCont">
				<div class="exchange-cont">
					<div class="exchange-w">
						<!-- <div class="exchange-w-1">
								<div class="exchange-w-1-part">
									<div>PAY WITH</div>
									<input type="text" value="0">
									<span>Balance : 0.580BTC</span>
								</div>
								<div class="exchange-w-1-part">
									<div>RECEIVE</div>
									<input type="text" value="0">
									<span>Balance : 5555UDAO</span>
								</div>
							</div>
							<div class="exchange-w-2">
								<div class="exchange-w-2-part exchange-w-2-select layer-activation">
									<div class="coin-name">
										<img src="./images/coin/coin_13.png" alt="">
										<div>BTC</div>
									</div>
									<img src="./images/arrow_left_g.png" alt="">
								</div>
								<div class="exchange-w-2-part">
									<img src="./images/ex_coin.png" alt="">
								</div>
								<div class="exchange-w-2-part exchange-w-2-select">
									<div class="coin-name">
										<img src="./images/coin/coin_0.png" alt="">
										<div>UDAO</div>
									</div>
									<img src="./images/arrow_left_g.png" alt="">
								</div>
							</div> -->
						<div class="exchange-flex">
							<div class="exchange-w-1">
								<div class="exchange-w-1-part">
									<div class="exchange-w-1-title">PAY WITH</div>
									<div class="spe-input">
										<input type="text" value="0" placeholder="0" onkeyup="onlyNumber(this)" onkeydown="onlyNumber(this)" id="paywithNum">
										<div class="exchange-w-2-part exchange-w-2-select changeOne myType paywith" type="paywith">
											<div class="coin-name">
												<img src="./images/coin/coin_14.png" alt="" class="CurrentImg">
												<div class="CurrentCoin">UNDT </div>
											</div>
										</div>
									</div>
									<span>Balance : </span><span class="payCurrentBalance balance">0</span><span class="coin">UNDT</span>
								</div>
							</div>
							<div class="exchange-w-1 exchange-w-img">
								<img src="./images/ex_coin.png" alt="" class="exchange-coin">
							</div>
							<div class="exchange-w-1">
								<div class="exchange-w-1-part">
									<div class="exchange-w-1-title">RECEIVE</div>
									<div class="spe-input">
										<input type="text" value="0" placeholder="0" onkeyup="onlyNumber(this)" onkeydown="onlyNumber(this)" id="receiveNum" disabled>
										<div class="exchange-w-2-part exchange-w-2-select changeTwo myType receive" type="receive">
											<div class="coin-name layer-activation">
												<img src="./images/coin/coin_0.png" alt="" class="CurrentImg">
												<div class="CurrentCoin">UDAO</div>
											</div>
											<img src="./images/arrow_left_g.png" alt="" class="layer-activation">
										</div>
									</div>
									<span>Balance : </span><span class="reCurrentBalance balance">0</span><span class="coin">UDAO</span>
								</div>
							</div>
						</div>
						<div class="exchange-w-3">
							<span>1</span> <span class="sellCoin">UNDT</span> = <span class="getNum">0</span> <span class="buyCoin">UDAO</span>
						</div>
						<div class="exchange-w-4">
							<div class="ex-btn" onclick="swap()">
								<img src="./images/ex_coin_2.png" alt="">
								<div>EXCHANGE</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div id="exCont">
				<div class="ex-cont">
					<div id="contFour">
						<h4 class="cont-title">EXCHAGE DETAILS</h4>
						<div class="exchange-table address-table">
							<table>
								<tbody>
									<tr style="border-top: 1px solid #d2d2d2;">
										<td>WALLET</td>
									</tr>
									<tr>
										<td>PAY</td>
									</tr>
									<tr>
										<td>RECEIVE</td>
									</tr>
									<tr>
										<td>RATE</td>
									</tr>
									<tr>
										<td>PROTOCOL</td>
									</tr>
									<tr>
										<td>EXCHANGE FEE</td>
									</tr>
									<tr>
										<td>TRANSACTIONFEE</td>
									</tr>
									<tr>
										<td>TOTAL COST</td>
									</tr>
									<tr>
										<td>WALLET</td>
									</tr>
									<tr>
										<td>RECEIVE</td>
									</tr>
									<tr>
										<td>PROTOCOL</td>
									</tr>
									<tr>
										<td>EXCHANGE FEE</td>
									</tr>
									<tr>
										<td>TRANSACTIONFEE</td>
									</tr>
									<tr>
										<td>TOTAL COST</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="readmore">
							<img src="./images/down.png" alt="">
							<span>READ MORE</span>
						</div>
					</div>
				</div>
			</div>
			<div id="footCont"> </div>
            <input type="hidden" id="address">
			<input type="hidden" id="getGasPrice" value="100000000000">
		</div>
	</div>
</body>

</html>

<script src="./js/layer.js"></script>

<script>
	$(document).ready(function () {
		$("#tabContent .tab-part").hide(); // Initially hide all content
		$("#tabs li:first").attr("id", "current"); // Activate first tab
		$("#tabContent div:first").fadeIn(); // Show first tab content

		$('#tabs a').click(function (e) {
			e.preventDefault();
			$("#tabContent .tab-part").hide(); //Hide all content
			$("#tabs li").attr("id", ""); //Reset id's
			$(this).parent().attr("id", "current"); // Activate this
			$('#' + $(this).attr('title')).fadeIn(); // Show content for current tab
		});

		var W = $(".progress-percent").width();
		var T = (W / 609 * 100).toFixed(0);
		$('.progress-tip div').text(' CURRENT PROGRESS ' + T + '%')
		$(".progress-bar .progress-tip").css('left', W - 100);

        let init_exchange = async () => {
            try {
                //实例化web3
                window.web3 = await getWeb3();
                //实例化需要用到的合约
                window.Contract_und = await getContract(abi_und, CONFIG.und_addr);
                window.Contract_udao = await getContract(abi_udao, CONFIG.udao_addr);
                window.Contract_exchange = await getContract(abi_exchange, CONFIG.exchange_addr);

                //调用合约方法
                let account = await ethAccounts();
                let paybalance = await balance_und(account);
                let rebalance = await balance_udao(account);
                $(".payCurrentBalance").html(paybalance);
                $(".reCurrentBalance").html(rebalance);
                undt2other(0.01);
            } catch (e) {
                console.log(e);
            }
        }

        init_exchange();
	})
</script>

<script>
	$(document).on("click", ".layer-activation", function () {

	    var type = $(this).parents(".myType").attr('type');
		layer.open({
			type: 1,
			title: false,
			closeBtn: 0,
			area: ['1143px', '764px'],
			shadeClose: true,
			content: '<div class="select-layer">' +
				'  <div class="layer-back">' +
				'  <img src="./images/layer_back.png" alt="">' +
				'  </div>' +
				'    <h3 class="select-layer-title">SELECTION OF CURRENCY</h3>' +
				'<div class="search-input">' +
				'<input type="text" name="" id="serch-content" value="" />' +
				'<img src="./images/search.png" alt="">' +
				'</div>' +
				'   <div class="select-cont" type="'+type+'">' +
				'  </div>' +
				'</div> '
		});


        if(coins != null && coins != undefined){
            $.each(coins, function (i, n) {
                var str = ' <div class="select-part">' +
                    '  <div class="selec-flex">' +
                    ' <input type="radio" id="coin'+i+'" name="radio">' +
                    '  <label for="coin'+i+'"></label>' +
                    '   <img src="'+n.logo+'" alt="">' +
                    ' <span>'+n.name+'</span>' +
                    '  </div>' +
                    '  <div class="stName">'+n.shortName+'</div>' +
                    '    </div>';
                $(".select-cont").append(str);
            })
        }
	});

    $(document).on("click", ":radio", function () {
       	var name = $(this).parents(".select-part").find('.stName').text();
       	var logo = $(this).parents(".selec-flex").find('img').attr('src');
       	var type = $(this).parents(".select-cont").attr('type');


        layer.closeAll();
        var dom = '.'+type;
        $(dom).find(".coin-name .CurrentImg").attr('src',logo);
        $(dom).find(".coin-name .CurrentCoin").text(name);
        $(dom).parents(".exchange-w-1-part").find('.coin').text(name);

        getPrice();
    });

    $(document).on("click", ".exchange-coin", function () {
        var changeOne = $(".changeOne").html();
        var changeTwo = $(".changeTwo").html();
        var balance0 = $(".balance").eq(0).html();
        var balance1 = $(".balance").eq(1).html();
        var coin0 = $(".coin").eq(0).html();
        var coin1 = $(".coin").eq(1).html();
        $(".changeOne").empty();
        $(".changeTwo").empty();
        $(".changeOne").html(changeTwo);
        $(".changeTwo").html(changeOne);
        $(".balance").eq(0).html(balance1);
        $(".balance").eq(1).html(balance0);
        $(".coin").eq(0).html(coin1);
        $(".coin").eq(1).html(coin0);

        getPrice()
    });

	$(document).on("click", ".layer-back", function () {
		layer.closeAll();
	});

    $(document).on("keyup", "#serch-content", function () {
		var serch = $(this).val();
        var has = 0;
        serch = String(serch).toUpperCase();
        $(".select-cont").empty();
        $.each(coins, function (i, n) {
            var regName = n.name.toUpperCase();
            var regShortName = n.shortName.toUpperCase();
            if(regName.indexOf(serch) >= 0 || regShortName.indexOf(serch) >= 0){
                var str = ' <div class="select-part">' +
                    '  <div class="selec-flex">' +
                    ' <input type="radio" id="coin'+i+'" name="radio">' +
                    '  <label for="coin'+i+'"></label>' +
                    '   <img src="'+n.logo+'" alt="">' +
                    ' <span>'+n.name+'</span>' +
                    '  </div>' +
                    '  <div class="stName">'+n.shortName+'</div>' +
                    '    </div>';
                $(".select-cont").append(str);
                has = 1;
			}
        })

		if(has == 0){
            // console.log("暂不支持该币种");
		}
    });

    $(document).on("keyup", "#paywithNum", function () {

    });

    async function swap() {
        var num = $("#paywithNum").val();
        if(num <= 0){
            alert("请输入兑换数量");
            return;
        }

		var payCoin = $(".paywith").find(".coin-name .CurrentCoin").text();
        payCoin   =   payCoin.replace(/^\s+|\s+$/g,"");
        var receiveCoin = $(".receive").find(".coin-name .CurrentCoin").text();
        receiveCoin   =   receiveCoin.replace(/^\s+|\s+$/g,"");

        if(payCoin == receiveCoin){
            alert("相同币种无法交换");
            return;
		}

		if(payCoin == "ETH"){
            eth2undt();
		}else if(receiveCoin == "ETH"){
            undt2eth();
		}else if(payCoin == "UNDT"){
            undt2other()
		}else if(receiveCoin == "UNDT"){
            other2undt()
		}else {
            alert("操作异常");
		}
    }

    async function getPrice() {
        var coin0 = $(".coin").eq(0).html();
        var coin1 = $(".coin").eq(1).html();
        $(".sellCoin").text(coin0);
        $(".buyCoin").text(coin1);

        if(coin0 == 'ETH' && coin1 == 'UNDT'){
            eth2undtNum();
		}else if(coin0 == 'UNDT' && coin1 == 'ETH'){
            undt2ethNum();
		}
    }
</script>